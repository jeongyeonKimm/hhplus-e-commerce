## E-Commerce 시나리오 분석

---

### 1️⃣ 잔액 충전 / 조회 기능

- 사용자 ID 및 충전할 금액을 받아 잔액을 충전한다.
  - 입력값: 사용자 ID, 충전 금액
  - 사용자 ID 검증
    - 사용자 ID가 0 이하가 아닌지 확인한다.
    - 사용자 ID에 따른 사용자가 실제로 존재하는지 확인한다.
  - 충전 금액 검증
    - 충전 금액이 음수가 아닌지 확인한다.
    - 충전 금액은 1회 최대 1,000,000원까지 가능하다.
    - 누적 금액은 최대 5,000,000원까지 가능하다.
  - 유효한 사용자 ID이고, 충전 가능한 금액이면 잔액을 충전된 잔액으로 업데이트 한다. 
  - 충전 이력을 남긴다.

- 사용자 ID를 통해 해당 사용자의 잔액을 조회한다.
  - 입력값: 사용자 ID
  - 사용자 ID 검증
    - 사용자 ID가 0 이하가 아닌지 확인한다.
    - 사용자 ID에 따른 사용자가 실제로 존재하는지 확인한다.
  - 사용자 ID를 이용해 해당 사용자가 보유하고 있는 포인트 조회한다.

### 2️⃣ 상품 조회 기능

- 전체 상품 목록을 조회한다.
  - 상품 정보(상품 ID, 상품명, 가격, 잔여수량) 목록을 응답한다.
  - 조회 시점의 상품별 산져 수량이 정확해야 한다.

### 3️⃣ 선착순 쿠폰 발급/쿠폰 조회 기능

- 선착순 쿠폰을 발급한다.
  - 입력값: 사용자 ID, 쿠폰 ID
  - 쿠폰 ID 검증
    - 쿠폰 ID가 0 이하가 아닌지 확인한다.
    - 쿠폰 ID에 따른 쿠폰이 실제로 존재하는지 확인한다.
    - 쿠폰의 잔여 수량이 0이 아닌지 확인한다.
    - 사용자가 발급 받은 쿠폰 내역을 조회하여 이미 발급 받은 쿠폰인지 확인한다.
  - 쿠폰의 잔여 수랑이 0보다 크고, 발급된 이력이 없으면 쿠폰을 발급한다.
  - 쿠폰 잔여 수량을 차감한다.

- 쿠폰 목록을 조회한다.
  - 입력값: 사용자 ID
  - 사용자 ID 검증
    - 사용자 ID가 0 이하가 아닌지 확인한다.
    - 사용자 ID에 따른 사용자가 실제로 존재하는지 확인한다.
  - 사용자의 쿠폰 목록을 조회한다.

### 4️⃣ 주문/결제 기능

- 사용자 ID, 쿠폰 ID, 구매 상품(상품 ID, 수량)을 입력 받아 주문을 한다.
  - 입력값: 사용자 ID, 쿠폰 ID, 구매 상품(상품 ID, 수량)
  - 사용자 ID 검증
    - 사용자 ID가 0 이하가 아닌지 확인한다.
    - 사용자 ID에 따른 사용자가 실제로 존재하는지 확인한다.
  - 구매하고자 하는 상품 수량이 현재 재고 이하인지 확인한다.
  - 쿠폰 ID 검증
    - 쿠폰 ID가 0 이하가 아닌지 확인한다. 
    - 쿠폰 ID에 따른 쿠폰이 실제로 존재하는지 확인한다.
    - 현재 시간이 쿠폰의 유효 시간 범위 내에 있는지 확인한다.
  - 적용 가능한 쿠푠인 경우 쿠폰이 적용된 최종 주문 금액을 반환한다.
  - 주문을 완료한다. (주문 상태 = NOT_PAID)

- 사용자 ID, 주문 ID를 입력 받아 결제를 한다.
  - 입력값: 사용자 ID, 주문 ID
  - 사용자 ID 검증
    - 사용자 ID가 0 이하가 아닌지 확인한다.
    - 사용자 ID에 따른 사용자가 실제로 존재하는지 확인한다.
  - 주문 ID 검증
    - 주문 ID가 0 이하가 아닌지 확인한다.
    - 주문 ID에 따른 주문이 실제로 존재하는지 확인한다.
  - 사용자의 보유 잔액을 조회한다.
    - 사용자의 보유 잔액이 주문 금액 이상인지 확인한다.
  - 포인트를 차감한다.
  - 포인트 차감 이력을 남긴다.
  - 결제를 완료한다.
  - 주문 상태를 PAID로 변경한다.
  - 주문 정보를 데이터 플랫폼에 전송한다.

### 5️⃣ 상위 상품 조회 기능

- 최근 3일간 가장 많이 팔린 상위 5개 상품 정보를 제공한다.
  - 스케줄러가 각 상품의 일별 판매량을 저장한다.
  - 베스트셀러 테이블에서 판매량 기준 상위 5개 상품을 반환한다.

